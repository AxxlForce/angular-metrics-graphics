/* Compiled 2015-04-14 02:04:00 */

"use strict";if(!angular.merge){var slice=[].slice,setHashKey=function(a,b){b?a.$$hashKey=b:delete a.$$hashKey},baseExtend=function(a,b,c){for(var d=a.$$hashKey,e=0,f=b.length;f>e;++e){var g=b[e];if(angular.isObject(g)||angular.isFunction(g))for(var h=Object.keys(g),i=0,j=h.length;j>i;i++){var k=h[i],l=g[k];c&&angular.isObject(l)?(angular.isObject(a[k])||(a[k]=angular.isArray(l)?[]:{}),baseExtend(a[k],[l],!0)):a[k]=l}}return setHashKey(a,d),a};angular.merge=function(a){return baseExtend(a,slice.call(arguments,1),!0)}}angular.module("metricsgraphics",["rt.debounce"]).factory("linkService",function(){var a={},b={},c={};return{set:function(d,e){var f=a[d]=b[d],g=b[d]=e,h=c[d];h&&angular.forEach(h,function(a){a(g,f)})},get:function(a){return b[a]},on:function(a,b){if(!angular.isFunction(b))throw new Error("Only functions allowed as callback argument");var d=c[a];d||(d=[],c[a]=d),d.push(b)},off:function(a,b){var d=c[a];if(d)for(var e=0;e<d.length;e++)d[e]===b&&(d.splice(e,1),e--)}}}).directive("chart",["$window","$timeout","debounce","linkService",function(a,b,c,d){return{link:function(c,e){function f(a){for(var b="ABCDEFGHIJKLMNOPQRSTUVWXYZ",c="",d=0;a>d;d++){var e=Math.floor(Math.random()*b.length);c+=b.substring(e,e+1)}return c}function g(a){if(!angular.isElement(a))throw new Error("Only DOM/JQuery allowed.");var b=a.clientWidth,c=getComputedStyle(a,null),d=c.getPropertyValue("padding-right");b-=parseInt(d);var e=c.getPropertyValue("padding-right");return b-=parseInt(e)}function h(a,b){var c=b.x+b.width/2,d=b.y,e=d+b.height,f=a.append("g").attr("class","focus-line"),g=f.append("line").attr("x1",c).attr("x2",c).attr("y1",d).attr("y2",e).style("opacity",0);return g}function i(a){var b=a.append("circle").attr("class","focus-circle").attr("r",3).style("pointer-events","none").style("stroke-width","1px").style("opacity",0);return b}function j(a){var b=a.append("span").attr("class","focus-txt");return b}function k(a){var b=a.append("div").attr("class","focus-tooltip").style("position","absolute").style("opacity",0);return b}function l(a){return a.append("rect").attr("x",c.graphBoundingBox.x).attr("y",c.graphBoundingBox.y).attr("width",c.graphBoundingBox.width).attr("height",c.graphBoundingBox.height).style("fill","none").style("stroke","none").style("pointer-events","all")}function m(a,b,c,d){if(null!==a||null!==b){if(null===a&&null!==b)return s.style("opacity",1),t.style("opacity",1),void u.style("opacity",1);if(null!==a&&null===b)return s.style("opacity",0),t.style("opacity",0),void u.style("opacity",0);s.attr("x1",b),s.attr("x2",b);var e=d.scales.X.invert(b),f=d3.bisector(function(a){return a[d.x_accessor]}).right,g=f(c,e,1),h=c[g-1],i=c[g],j=e-h[d.x_accessor]>i[d.x_accessor]-e?i:h,k=j[d.y_accessor],l=d.scales.Y(k);t.attr("cx",b),t.attr("cy",l),v.html(k),u.style("left",q[0][0].offsetLeft+b+10+"px").style("top",q[0][0].offsetTop+10+"px")}}function n(a,b){var e=function(c,e){d.get("target")!==x.target&&m(e,c,a,b)};return d.on("x",e),c.$on("$destroy",function(){d.off("x",e)}),e}function o(a,b){if(a&&a.length>0){angular.isDefined(b.width)||(x.width=g(w[0])),angular.merge(x,b),x.data&&(x.data=null);var f=angular.copy(x);if(f.data=a,!x.linked&&p&&(d.off(p),p=null),x.linked&&!p&&(p=n(a,f)),MG.data_graphic(f),q)return;q=d3.select(e[0]).select("svg"),c.graphBoundingBox=d3.select(e[0]).select("svg .mg-clip-path rect")[0][0].getBBox(),r=q.append("g"),s=h(r,c.graphBoundingBox),t=i(r),u=k(d3.select(e[0])),v=j(u);var o=l(r);o.on("mouseover",function(){var b=d3.mouse(this)[0];m(null,b,a,f),x.linked&&(d.set("target",x.target),d.set("x",b))}).on("mouseout",function(b){var c=d3.mouse(this)[0];m(c,null,a,f),x.linked&&(d.set("target",null),d.set("x",null))}).on("mousemove",function(b){var c=d3.mouse(this)[0];m(c,c,a,f),x.linked&&d.set("x",c)}),q.on("mouseover",function(){this.appendChild(r.node())})}}var p,q,r,s,t,u,v,w=e.parent(),x={};e[0].id=e[0].id?e[0].id:"mg-chart-"+f(5),x.target="#"+e[0].id,c.$watchCollection("data",function(a){o(a,x)}),c.$watch("options",function(a){a.target&&delete a.target,o(c.data,a)},!0),angular.element(a).on("resize",function(){delete x.width,o(c.data,x)}),b(function(){o(c.data,x)})},restrict:"E",scope:{data:"=",options:"=",graphBoundingBox:"=?"}}}]);
//# sourceMappingURL=angular-metrics-graphics.min.map